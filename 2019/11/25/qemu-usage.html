<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-03-03 Thu 11:47 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>qemuä½¿ç”¨è¸©å‘</title>
<meta name="author" content="schspa" />
<meta name="description" content="qemu.org" />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="/images/rose-red.png" type="image/x-icon" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha256-sAcc18zvMnaJZrNT4v8J0T4HqzEUiUTlVFgDIywjQek=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/animate.min.css" />
<link rel="stylesheet" href="/css/all.min.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />
<link rel="stylesheet" type="text/css" href="/css/navbar.css" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" integrity="sha256-/hGxZHGQ57fXLp+NDusFZsZo/PG21Bp2+hXYV5a6w+g=" crossorigin="anonymous"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/darkreader.js"></script>
<script src="/user.config.js"></script>
<script src="/js/main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div class="mobile-container">
  <!-- Top Navigation Menu -->
  <div class="topnav">
    <div id="header">
      <a href="/" class="logo">Schspa's Blog</a>
      <a href="javascript:void(0);" class="icon" onclick="toggleheader()">
        <i class="fa fa-bars"></i>
      </a>
    </div>
    <div id="nav_headers">
      <a href="/sitemap.html" class="menu-item">Categories</a>
    </div>
  </div>
  <!-- End smartphone / tablet look -->
</div>

<header id="header" class="header">
  <div class="logo-wrapper">
    <a href="/" class="logo">Schspa's Blogs</a>
  </div>

  <nav class="site-navbar">
    <ul id="menu" class="menu">
      <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li>
      <li class="menu-item">
        <a class="menu-item-link" href="/sitemap.html">Categories</a>
      </li>
    </ul>
  </nav>
</header>
</div>
<div id="content" class="content">
<h1 class="title">qemuä½¿ç”¨è¸©å‘</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3b3d36e">ç¼–è¯‘qemu</a></li>
<li><a href="#orgb47d46f">è¿è¡Œ</a></li>
<li><a href="#org7f0e372">æ¨å‡º</a></li>
<li><a href="#org70f77a9">æ–‡ä»¶å…±äº«</a>
<ul>
<li><a href="#orgf35502d">9P over virtiofs</a></li>
</ul>
</li>
<li><a href="#org5b27791">ç½‘ç»œè®¾ç½®</a>
<ul>
<li><a href="#orgd586e15">linux Host</a></li>
<li><a href="#orgd4d7f0f"><span class="todo TODO">TODO</span> Macos Host</a></li>
<li><a href="#org84e6246">qemu command line</a></li>
</ul>
</li>
<li><a href="#org181cd94">QMP (QEMU Machine Protocol)</a></li>
<li><a href="#org484d865">å‚è€ƒæ–‡æ¡£</a></li>
</ul>
</div>
</div>

<div id="outline-container-org3b3d36e" class="outline-2">
<h2 id="org3b3d36e">ç¼–è¯‘qemu</h2>
<div class="outline-text-2" id="text-org3b3d36e">
<div class="org-src-container">
<pre class="src src-bash"><code>./configure --target-list=aarch64-softmmu --enable-virtfs</code>
<code>make -j8</code>
</pre>
</div>
<p>
<b>Mac OS ä¸æ”¯æŒ9Pfs</b><br>
</p>
</div>
</div>

<div id="outline-container-orgb47d46f" class="outline-2">
<h2 id="orgb47d46f">è¿è¡Œ</h2>
<div class="outline-text-2" id="text-orgb47d46f">
<div class="org-src-container">
<pre class="src src-bash"><code>qemu-system-aarch64 -machine virt -cpu cortex-a57 -machine <span style="color: #dcaeea;">type</span>=virt -nographic -smp 4 -m 2048 --append <span style="color: #98be65;">"console=ttyAMA0"</span> --kernel ~/work/src/linux.git/arch/arm64/boot/Image --initrd ~/work/buildroot-2018.05/output/images/rootfs.cpio.bz2</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f0e372" class="outline-2">
<h2 id="org7f0e372">æ¨å‡º</h2>
<div class="outline-text-2" id="text-org7f0e372">
<div class="org-src-container">
<pre class="src src-bash"><code>Ctrl-A x</code>
</pre>
</div>
</div>
</div>
<div id="outline-container-org70f77a9" class="outline-2">
<h2 id="org70f77a9">æ–‡ä»¶å…±äº«</h2>
<div class="outline-text-2" id="text-org70f77a9">
</div>
<div id="outline-container-orgf35502d" class="outline-3">
<h3 id="orgf35502d"><a href="https://wiki.qemu.org/Documentation/9psetup">9P over virtiofs</a></h3>
<div class="outline-text-3" id="text-orgf35502d">
<p>
9pfsæ˜¯åŸºäºç½‘ç»œçš„æ–‡ä»¶å…±äº«åè®®ï¼Œqemuä¸­çš„è½¯ä»¶å¯ä»¥é€šè¿‡æ­¤ç§æ–¹æ³•æ¥è®¿é—®å®¿ä¸»æœºä¸­çš„æ–‡ä»¶ã€‚è¯¦è§Plan 9 9p remote filesystem protocol<br>
<b>qemuåœ¨Mac OSä¸Šä¸æ”¯æŒvirtioï¼Œæ•…æ— æ³•ä½¿ç”¨ä»¥ä¸‹çš„æ–¹æ³•</b><br>
å‚æ•°è®¾ç½®ï¼š<br>
</p>
<ul class="org-ul">
<li><p>
é’ˆå¯¹å®¿ä¸»æœº<br>
</p>
<blockquote>
<p>
-fsdev local,id=shareid,path=/home/schspa/work/src/share,security_model=none<br>
</p>
</blockquote>
<p>
ä¸Šè¿°å‚æ•°å‘Šè¯‰QEMUè¦è®¾ç½®ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè®¾å¤‡ï¼Œä½¿ç”¨æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿï¼Œidè®¾ç½®ä¸ºshareid<br>
</p></li>
<li><p>
é’ˆå¯¹å®¢æˆ·æœº<br>
</p>
<blockquote>
<p>
-device virtio-9p-device,fsdev=shareid,mount_tag=share<br>
</p>
</blockquote>
<p>
ä¸Šé¢çš„å‚æ•°å‘Šè¯‰å‘å®¢æˆ·æœºæ·»åŠ ä¸€ä¸ªè®¾å¤‡ï¼Œè®¾å¤‡ç±»å‹æ˜¯virtio-9p-deviceï¼Œè¿æ¥åˆ°è®¾å¤‡shareid, æŒ‚è½½æ—¶çš„tagä¸ºshare<br>
</p></li>
<li><p>
æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹<br>
åœ¨å®¢æˆ·ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦æŒ‚è½½å…±äº«çš„æ–‡ä»¶å¤¹ï¼Œä¸Šé¢å·²ç»æ˜¾ç¤ºå‡ºæ¥mount_tagæ˜¯share<br>
æŒ‚è½½å‘½ä»¤<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>mount -t 9p -o <span style="color: #dcaeea;">trans</span>=virtio share /mnt/share</code>
</pre>
</div>
<p>
mount tagä¹Ÿå¯ä»¥é€šè¿‡sysfsæ¥æŸ¥çœ‹<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>/sys/bus/virtio/drivers/9pnet_virtio/virtio&lt;n&gt;/mount_tag         </code>
</pre>
</div></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org5b27791" class="outline-2">
<h2 id="org5b27791">ç½‘ç»œè®¾ç½®</h2>
<div class="outline-text-2" id="text-org5b27791">
</div>
<div id="outline-container-orgd586e15" class="outline-3">
<h3 id="orgd586e15">linux Host</h3>
<div class="outline-text-3" id="text-orgd586e15">
<ul class="org-ul">
<li><p>
è®¾ç½®ç½‘ç»œè®¾å¤‡<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/usr/bin/</span><span style="color: #51afef;">env</span><span style="color: #5B6268;"> bash</span></code>
<code></code>
<code>sudo ip link add br0 type bridge</code>
<code>sudo ip link set br0 up</code>
<code>sudo ip addr add 192.168.123.1/24 broadcast 192.168.123.255 dev br0</code>
<code>sudo dnsmasq  --strict-order --except-interface=lo --interface=br0 --listen-addr=192.168.123.1 --bind-interfaces --dhcp-range=192.168.123.101,192.168.123.254 --pid-file=/var/run/qemu-dhcp-br0.pid</code>
<code></code>
<code>sudo ip tuntap add tap0 mod tap user $<span style="color: #dcaeea;">UID</span></code>
<code>sudo ip link set dev tap0 up</code>
<code>sudo ip link set dev tap0 master br0</code>
</pre>
</div></li>
<li><p>
å¸è½½ç½‘ç»œè®¾å¤‡<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/usr/bin/</span><span style="color: #51afef;">env</span><span style="color: #5B6268;"> bash</span></code>
<code></code>
<code>sudo ip link set dev tap0 nomaster</code>
<code>sudo ip link set tap0 down</code>
<code>sudo ip tuntap del tap0 mod tap</code>
<code></code>
<code>sudo ip link set br0 down</code>
<code>sudo ip link delete br0 type bridge</code>
<code>sudo kill $(cat /var/run/qemu-dhcp-br0.pid)</code>
</pre>
</div>
<p>
ä¸Šè¿°è„šæœ¬æ·»åŠ äº†ä¸€ä¸ªtapè®¾å¤‡<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>ï¼Œå¹¶ä½¿ç”¨dnsmasqç½‘æ¡¥æ¡¥å¼€å¯äº†dhcpï¼Œå®¢æˆ·ç«¯å¯åŠ¨ä¹‹åå³å¯è‡ªåŠ¨è·å–ipåœ°å€ã€‚ç”±äºæ²¡æœ‰å°†å®ä½“ç½‘å¡åŠ å…¥åˆ°br0çš„ç½‘æ¡¥ä¹‹ä¸­ï¼Œç›®å‰å®¢æˆ·æœºç³»ç»Ÿè¿˜æ— æ³•è”ç½‘ã€‚<br>
</p></li>
</ul>
</div>
</div>
<div id="outline-container-orgd4d7f0f" class="outline-3">
<h3 id="orgd4d7f0f"><span class="todo TODO">TODO</span> Macos Host</h3>
</div>
<div id="outline-container-org84e6246" class="outline-3">
<h3 id="org84e6246">qemu command line</h3>
<div class="outline-text-3" id="text-org84e6246">
<div class="org-src-container">
<pre class="src src-bash"><code>-netdev tap,<span style="color: #dcaeea;">ifname</span>=tap0,<span style="color: #dcaeea;">id</span>=net0,<span style="color: #dcaeea;">script</span>=no,<span style="color: #dcaeea;">downscript</span>=no -device virtio-net-device,<span style="color: #dcaeea;">netdev</span>=net0,<span style="color: #dcaeea;">mac</span>=52:55:00:fa:ee:10</code>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org181cd94" class="outline-2">
<h2 id="org181cd94">QMP (QEMU Machine Protocol)</h2>
<div class="outline-text-2" id="text-org181cd94">
<p>
<a href="https://wiki.qemu.org/Documentation/QMP">https://wiki.qemu.org/Documentation/QMP</a><br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>-qmp tcp:localhost:4444,server,nowait</code>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><code>telnet localhost 4444</code>
<code>Trying ::1...</code>
<code>Connected to localhost.</code>
<code>Escape character is <span style="color: #98be65;">'^]'</span>.</code>
<code>{<span style="color: #98be65;">"QMP"</span>: {<span style="color: #98be65;">"version"</span>: {<span style="color: #98be65;">"qemu"</span>: {<span style="color: #98be65;">"micro"</span>: 1, <span style="color: #98be65;">"minor"</span>: 0, <span style="color: #98be65;">"major"</span>: 4}, <span style="color: #98be65;">"package"</span>: <span style="color: #98be65;">"v4.0.1-193-g8655781df2"</span>}, <span style="color: #98be65;">"capabilities"</span>: [<span style="color: #98be65;">"oob"</span>]}}</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org484d865" class="outline-2">
<h2 id="org484d865">å‚è€ƒæ–‡æ¡£</h2>
<div class="outline-text-2" id="text-org484d865">
<p>
<a href="http://www.voidcn.com/article/p-xlgkygpv-p.html">http://www.voidcn.com/article/p-xlgkygpv-p.html</a><br>
<a href="https://kennedy-han.github.io/2015/06/15/QEMU-arm64-guide.html">https://kennedy-han.github.io/2015/06/15/QEMU-arm64-guide.html</a><br>
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://segmentfault.com/a/1190000009249039">Linuxè™šæ‹Ÿç½‘ç»œè®¾å¤‡ä¹‹tun/tap</a><br>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<script src="https://utteranc.es/client.js"
    repo="schspa/schspa.github.io"
    issue-term="title"
    label="âœ¨ğŸ’¬âœ¨"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
<div class="me">
  <span><b>Contact me via :)</b><span>
  <div class="contact">
    <a id="email" href="mailto:schspa@gmail.com" target="_blank"><i class="fab fa-mailchimp animated heartBeat delay-2s slower"></i></a>
    <a id="github" href="//github.com/schspa" target="_blank"><i class="fab fa-github animated heartBeat delay-2s slower"></i></a>
  </div>
</div>

<div id="jinrishici-sentence" style="font-weight: 700;">è™šæ€€ä¹ƒè‹¥è°·ï¼Œæ°´æ·±åˆ™æµç¼“ã€‚</div>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
</div>
</body>
</html>

<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-01-31 æ—¥ 22:54 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>qemuä½¿ç”¨è¸©å‘</title>
<meta name="generator" content="Org mode">
<meta name="author" content="schspa">
<meta name="description" content="qemu.org"
>
<link rel="shortcut icon" href="/images/rose-red.png" type="image/x-icon" />
<link rel="stylesheet" href="/css/animate.min.css" />
<link rel="stylesheet" href="/css/all.min.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />
<link rel="stylesheet" type="text/css" href="/css/navbar.css" />
<script src="/js/jquery.min.js"></script>
<script src="/js/darkreader.js"></script>
<script src="/user.config.js"></script>
<script src="/js/main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div class="mobile-container">
  <!-- Top Navigation Menu -->
  <div class="topnav">
    <div id="header">
      <a href="/" class="logo">Schspa's Blog</a>
      <a href="javascript:void(0);" class="icon" onclick="toggleheader()">
        <i class="fa fa-bars"></i>
      </a>
    </div>
    <div id="nav_headers">
      <a href="/sitemap.html" class="menu-item">Categories</a>
    </div>
  </div>
  <!-- End smartphone / tablet look -->
</div>

<header id="header" class="header">
  <div class="logo-wrapper">
    <a href="/" class="logo">Schspa's Blogs</a>
  </div>

  <nav class="site-navbar">
    <ul id="menu" class="menu">
      <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li>
      <li class="menu-item">
        <a class="menu-item-link" href="/sitemap.html">Categories</a>
      </li>
    </ul>
  </nav>
</header>
</div>
<div id="content">
<h1 class="title">qemuä½¿ç”¨è¸©å‘</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf0a8126">ç¼–è¯‘qemu</a></li>
<li><a href="#org8a500c1">è¿è¡Œ</a></li>
<li><a href="#org47a957b">æ–‡ä»¶å…±äº«</a>
<ul>
<li><a href="#orgb4eb3b7">9P over virtiofs</a></li>
</ul>
</li>
<li><a href="#org5c018ee">ç½‘ç»œè®¾ç½®</a>
<ul>
<li><a href="#org3fcd27b">linux Host</a></li>
<li><a href="#org1e9fe5e"><span class="todo TODO">TODO</span> Macos Host</a></li>
<li><a href="#orgc381c14">qemu command line</a></li>
</ul>
</li>
<li><a href="#org19ab1fe">å‚è€ƒæ–‡æ¡£</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgf0a8126" class="outline-2">
<h2 id="orgf0a8126">ç¼–è¯‘qemu</h2>
<div class="outline-text-2" id="text-orgf0a8126">
<div class="org-src-container">
<pre class="src src-bash">./configure --target-list=aarch64-softmmu --enable-virtfs
make -j8
</pre>
</div>
<p>
<b>Mac OS ä¸æ”¯æŒ9Pfs</b><br>
</p>
</div>
</div>

<div id="outline-container-org8a500c1" class="outline-2">
<h2 id="org8a500c1">è¿è¡Œ</h2>
<div class="outline-text-2" id="text-org8a500c1">
<div class="org-src-container">
<pre class="src src-bash">qemu-system-aarch64 -machine virt -cpu cortex-a57 -machine <span style="color: #dcaeea;">type</span>=virt -nographic -smp 4 -m 2048 --append <span style="color: #98be65;">"console=ttyAMA0"</span> --kernel ~/work/src/linux.git/arch/arm64/boot/Image --initrd ~/work/buildroot-2018.05/output/images/rootfs.cpio.bz2
</pre>
</div>
</div>
</div>

<div id="outline-container-org47a957b" class="outline-2">
<h2 id="org47a957b">æ–‡ä»¶å…±äº«</h2>
<div class="outline-text-2" id="text-org47a957b">
</div>
<div id="outline-container-orgb4eb3b7" class="outline-3">
<h3 id="orgb4eb3b7"><a href="https://wiki.qemu.org/Documentation/9psetup">9P over virtiofs</a></h3>
<div class="outline-text-3" id="text-orgb4eb3b7">
<p>
9pfsæ˜¯åŸºäºç½‘ç»œçš„æ–‡ä»¶å…±äº«åè®®ï¼Œqemuä¸­çš„è½¯ä»¶å¯ä»¥é€šè¿‡æ­¤ç§æ–¹æ³•æ¥è®¿é—®å®¿ä¸»æœºä¸­çš„æ–‡ä»¶ã€‚è¯¦è§Plan 9 9p remote filesystem protocol<br>
<b>qemuåœ¨Mac OSä¸Šä¸æ”¯æŒvirtioï¼Œæ•…æ— æ³•ä½¿ç”¨ä»¥ä¸‹çš„æ–¹æ³•</b><br>
å‚æ•°è®¾ç½®ï¼š<br>
</p>
<ul class="org-ul">
<li><p>
é’ˆå¯¹å®¿ä¸»æœº<br>
</p>
<blockquote>
<p>
-fsdev local,id=shareid,path=/home/schspa/work/src/share,security_model=none<br>
</p>
</blockquote>
<p>
ä¸Šè¿°å‚æ•°å‘Šè¯‰QEMUè¦è®¾ç½®ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè®¾å¤‡ï¼Œä½¿ç”¨æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿï¼Œidè®¾ç½®ä¸ºshareid<br>
</p></li>
<li><p>
é’ˆå¯¹å®¢æˆ·æœº<br>
</p>
<blockquote>
<p>
-device virtio-9p-device,fsdev=shareid,mount_tag=share<br>
</p>
</blockquote>
<p>
ä¸Šé¢çš„å‚æ•°å‘Šè¯‰å‘å®¢æˆ·æœºæ·»åŠ ä¸€ä¸ªè®¾å¤‡ï¼Œè®¾å¤‡ç±»å‹æ˜¯virtio-9p-deviceï¼Œè¿æ¥åˆ°è®¾å¤‡shareid, æŒ‚è½½æ—¶çš„tagä¸ºshare<br>
</p></li>
<li><p>
æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹<br>
åœ¨å®¢æˆ·ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦æŒ‚è½½å…±äº«çš„æ–‡ä»¶å¤¹ï¼Œä¸Šé¢å·²ç»æ˜¾ç¤ºå‡ºæ¥mount_tagæ˜¯share<br>
æŒ‚è½½å‘½ä»¤<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">mount -t 9p -o <span style="color: #dcaeea;">trans</span>=virtio share /mnt/share
</pre>
</div>
<p>
mount tagä¹Ÿå¯ä»¥é€šè¿‡sysfsæ¥æŸ¥çœ‹<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">/sys/bus/virtio/drivers/9pnet_virtio/virtio&lt;n&gt;/mount_tag         
</pre>
</div></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org5c018ee" class="outline-2">
<h2 id="org5c018ee">ç½‘ç»œè®¾ç½®</h2>
<div class="outline-text-2" id="text-org5c018ee">
</div>
<div id="outline-container-org3fcd27b" class="outline-3">
<h3 id="org3fcd27b">linux Host</h3>
<div class="outline-text-3" id="text-org3fcd27b">
<ul class="org-ul">
<li><p>
è®¾ç½®ç½‘ç»œè®¾å¤‡<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/usr/bin/</span><span style="color: #51afef;">env</span><span style="color: #5B6268;"> bash</span>

sudo ip link add br0 type bridge
sudo ip link set br0 up
sudo ip addr add 192.168.123.1/24 broadcast 192.168.123.255 dev br0
sudo dnsmasq  --strict-order --except-interface=lo --interface=br0 --listen-addr=192.168.123.1 --bind-interfaces --dhcp-range=192.168.123.101,192.168.123.254 --pid-file=/var/run/qemu-dhcp-br0.pid

sudo ip tuntap add tap0 mod tap user $<span style="color: #dcaeea;">UID</span>
sudo ip link set dev tap0 up
sudo ip link set dev tap0 master br0
</pre>
</div></li>
<li><p>
å¸è½½ç½‘ç»œè®¾å¤‡<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/usr/bin/</span><span style="color: #51afef;">env</span><span style="color: #5B6268;"> bash</span>

sudo ip link set dev tap0 nomaster
sudo ip link set tap0 down
sudo ip tuntap del tap0 mod tap

sudo ip link set br0 down
sudo ip link delete br0 type bridge
sudo kill $(cat /var/run/qemu-dhcp-br0.pid)
</pre>
</div>
<p>
ä¸Šè¿°è„šæœ¬æ·»åŠ äº†ä¸€ä¸ªtapè®¾å¤‡<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>ï¼Œå¹¶ä½¿ç”¨dnsmasqç½‘æ¡¥æ¡¥å¼€å¯äº†dhcpï¼Œå®¢æˆ·ç«¯å¯åŠ¨ä¹‹åå³å¯è‡ªåŠ¨è·å–ipåœ°å€ã€‚ç”±äºæ²¡æœ‰å°†å®ä½“ç½‘å¡åŠ å…¥åˆ°br0çš„ç½‘æ¡¥ä¹‹ä¸­ï¼Œç›®å‰å®¢æˆ·æœºç³»ç»Ÿè¿˜æ— æ³•è”ç½‘ã€‚<br>
</p></li>
</ul>
</div>
</div>
<div id="outline-container-org1e9fe5e" class="outline-3">
<h3 id="org1e9fe5e"><span class="todo TODO">TODO</span> Macos Host</h3>
</div>
<div id="outline-container-orgc381c14" class="outline-3">
<h3 id="orgc381c14">qemu command line</h3>
<div class="outline-text-3" id="text-orgc381c14">
<div class="org-src-container">
<pre class="src src-bash">-netdev tap,<span style="color: #dcaeea;">ifname</span>=tap0,<span style="color: #dcaeea;">id</span>=net0,<span style="color: #dcaeea;">script</span>=no,<span style="color: #dcaeea;">downscript</span>=no -device virtio-net-device,<span style="color: #dcaeea;">netdev</span>=net0,<span style="color: #dcaeea;">mac</span>=52:55:00:fa:ee:10
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org19ab1fe" class="outline-2">
<h2 id="org19ab1fe">å‚è€ƒæ–‡æ¡£</h2>
<div class="outline-text-2" id="text-org19ab1fe">
<p>
<a href="http://www.voidcn.com/article/p-xlgkygpv-p.html">http://www.voidcn.com/article/p-xlgkygpv-p.html</a><br>
<a href="https://kennedy-han.github.io/2015/06/15/QEMU-arm64-guide.html">https://kennedy-han.github.io/2015/06/15/QEMU-arm64-guide.html</a><br>
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://segmentfault.com/a/1190000009249039">Linuxè™šæ‹Ÿç½‘ç»œè®¾å¤‡ä¹‹tun/tap</a><br>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<script src="https://utteranc.es/client.js"
    repo="schspa/schspa.github.io"
    issue-term="title"
    label="âœ¨ğŸ’¬âœ¨"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
<div class="me">
  <span><b>Contact me via :)</b><span>
  <div class="contact">
    <a id="email" href="mailto:schspa@gmail.com" target="_blank"><i class="fab fa-mailchimp animated heartBeat delay-2s slower"></i></a>
    <a id="github" href="//github.com/schspa" target="_blank"><i class="fab fa-github animated heartBeat delay-2s slower"></i></a>
  </div>
</div>

<div id="jinrishici-sentence" style="font-weight: 700;">è™šæ€€ä¹ƒè‹¥è°·ï¼Œæ°´æ·±åˆ™æµç¼“ã€‚</div>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
</div>
</body>
</html>

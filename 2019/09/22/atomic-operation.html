<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-03-03 Thu 11:48 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Atomic operation in aarch64</title>
<meta name="author" content="Schspa" />
<meta name="description" content="Atomic operation in aarch64" />
<meta name="keywords" content=":atomic operation:" />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="/images/rose-red.png" type="image/x-icon" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha256-sAcc18zvMnaJZrNT4v8J0T4HqzEUiUTlVFgDIywjQek=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/animate.min.css" />
<link rel="stylesheet" href="/css/all.min.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />
<link rel="stylesheet" type="text/css" href="/css/navbar.css" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" integrity="sha256-/hGxZHGQ57fXLp+NDusFZsZo/PG21Bp2+hXYV5a6w+g=" crossorigin="anonymous"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/darkreader.js"></script>
<script src="/user.config.js"></script>
<script src="/js/main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div class="mobile-container">
  <!-- Top Navigation Menu -->
  <div class="topnav">
    <div id="header">
      <a href="/" class="logo">Schspa's Blog</a>
      <a href="javascript:void(0);" class="icon" onclick="toggleheader()">
        <i class="fa fa-bars"></i>
      </a>
    </div>
    <div id="nav_headers">
      <a href="/sitemap.html" class="menu-item">Categories</a>
    </div>
  </div>
  <!-- End smartphone / tablet look -->
</div>

<header id="header" class="header">
  <div class="logo-wrapper">
    <a href="/" class="logo">Schspa's Blogs</a>
  </div>

  <nav class="site-navbar">
    <ul id="menu" class="menu">
      <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li>
      <li class="menu-item">
        <a class="menu-item-link" href="/sitemap.html">Categories</a>
      </li>
    </ul>
  </nav>
</header>
</div>
<div id="content" class="content">
<h1 class="title">Atomic operation in aarch64</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3ae0d65">åœ¨Linuxå†…æ ¸ä¸­çœ‹åˆ°ä¸‹é¢è¿™å¥è¯:</a></li>
<li><a href="#org9519055">å…ˆçœ‹çœ‹ARM64å¹³å°åŸå­æ“ä½œå®ç°åŸç†</a>
<ul>
<li><a href="#org9532ed4">linux</a></li>
<li><a href="#orgacbbfea">ARM64å¹³å°åŸå­æ“ä½œæŒ‡ä»¤</a></li>
</ul>
</li>
<li><a href="#org4ec3ecb">ARMV8aä¸­çš„è®¾ç½®</a>
<ul>
<li><a href="#org43eb0e5">ARMv8aæ‰‹å†Œ</a></li>
<li><a href="#org23693f0">Crotex A55æ‰‹å†Œ</a></li>
<li><a href="#orgc36d129">CPUECTLR.ATOM</a></li>
</ul>
</li>
<li><a href="#org0dcb094">æ€»çº¿çš„è®¾ç½®</a></li>
<li><a href="#orgedc72ed">å¯¹äºå†…æ ¸æ³¨é‡Šä¸­æåˆ°çš„omapå¹³å°ï¼Œç¡¬ä»¶ä¸Šä½¿ç”¨äº†å“ªç§äº’è¿ç½‘ç»œï¼Œæœ€ç»ˆå¯¼è‡´äº†ç³»ç»Ÿæ— æ³•åœ¨non-cachedå†…å­˜ä¸­ä½¿ç”¨åŸå­æ“ä½œï¼Ÿ</a></li>
<li><a href="#org373001f"><span class="done DONE">DONE</span> å¯¹äºä¸Šè¿°å¹³å°ï¼Œå¦‚æœè½¯ä»¶ä¸Šå»ä½¿ç”¨åŸå­æ“ä½œæŒ‡ä»¤è®¿é—®non-cachedå†…å­˜ï¼Œä¼šæœ‰ä»€ä¹ˆåæœï¼Ÿ</a></li>
</ul>
</div>
</div>

<div id="outline-container-org3ae0d65" class="outline-2">
<h2 id="org3ae0d65">åœ¨Linuxå†…æ ¸ä¸­çœ‹åˆ°ä¸‹é¢è¿™å¥è¯:</h2>
<div class="outline-text-2" id="text-org3ae0d65">
<blockquote>
<p>
At least on ARM, pgprot_noncached causes the<br>
memory to be mapped strongly ordered, and atomic operations on strongly ordered<br>
memory are implementation defined, and won't work on many ARMs such as omaps.<br>
</p>
</blockquote>
<p>
æ‰€ä»¥, ä¸ºä»€ä¹ˆå¯¹ç”¨æˆ·non-cachedçš„å†…å­˜,éƒ¨åˆ†å¹³å°ä¸æ”¯æŒåŸå­æ“ä½œ?<br>
</p>
</div>
</div>
<div id="outline-container-org9519055" class="outline-2">
<h2 id="org9519055">å…ˆçœ‹çœ‹ARM64å¹³å°åŸå­æ“ä½œå®ç°åŸç†</h2>
<div class="outline-text-2" id="text-org9519055">
<p>
å…ˆçœ‹çœ‹Linuxå†…æ ¸ä¸­çš„å®ç°ã€‚<br>
</p>
</div>
<div id="outline-container-org9532ed4" class="outline-3">
<h3 id="org9532ed4">linux</h3>
<div class="outline-text-3" id="text-org9532ed4">
<ul class="org-ul">
<li><p>
atomic_read &amp; atomic_set<br>
</p>
<div class="org-src-container">
<pre class="src src-C"><code><span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">atomic_read</span>(<span style="color: #dcaeea;">v</span>)                  READ_ONCE((v)-&gt;counter)</code>
<code><span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">atomic_set</span>(<span style="color: #dcaeea;">v</span>, <span style="color: #dcaeea;">i</span>)                WRITE_ONCE(((v)-&gt;counter), (i))</code>
</pre>
</div>
<p>
å¯¹äºè¯»å’Œå†™ï¼Œåœ¨ARMå¹³å°ä¸Šä½¿ç”¨æ­£å¸¸ä½¿ç”¨çš„è¯»å†™æ“ä½œå³å¯ã€‚<br>
</p></li>
<li><p>
atomic_add &amp; atomic_dec<br>
å¯¹äºåŠ å‡çš„åŸå­æ“ä½œï¼Œç”±äºéœ€è¦æ‰§è¡Œè¯»ï¼Œæ”¹ï¼Œå†™ä¸‰æ­¥ï¼Œéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æŒ‡ä»¤æ‰å¯ä»¥å®ç°ã€‚<br>
</p>
<div class="org-src-container">
<pre class="src src-C"><code><span style="color: #51afef;">static</span> <span style="color: #51afef;">inline</span> <span style="color: #ECBE7B;">void</span></code>
<code>     <span style="color: #c678dd;">atomic_add</span>(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>, <span style="color: #ECBE7B;">atomic_t</span> *<span style="color: #dcaeea;">v</span>)</code>
<code>{</code>
<code>     kasan_check_write(v, <span style="color: #51afef;">sizeof</span>(*v));</code>
<code>     arch_atomic_add(i, v);</code>
<code>}</code>
<code><span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">atomic_add</span> atomic_add</code>
<code></code>
<code><span style="color: #c678dd;">ATOMIC_OP</span>(atomic_add)</code>
<code></code>
<code><span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">ATOMIC_OP</span>(<span style="color: #dcaeea;">op</span>)                                                                   \</code>
<code>     <span style="color: #51afef;">static</span> <span style="color: #51afef;">inline</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">arch_</span>##op(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>, <span style="color: #ECBE7B;">atomic_t</span> *<span style="color: #dcaeea;">v</span>)   \</code>
<code>     {                                                                                                  \</code>
<code>          __lse_ll_sc_body(op, i, v);                                   \</code>
<code>     }</code>
<code></code>
<code><span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">__lse_ll_sc_body</span>(<span style="color: #dcaeea;">op</span>, ...)                               \</code>
<code>     ({                                                                                 \</code>
<code>          system_uses_lse_atomics() ?                   \</code>
<code>               __lse_##op(__VA_ARGS__) :                \</code>
<code>               __ll_sc_##op(__VA_ARGS__);               \</code>
<code>     })</code>
<code></code>
</pre>
</div></li>
</ul>
</div>
<ul class="org-ul">
<li><a id="orga3ac709"></a>Linux atomicæŒ‡ä»¤çš„ä¸¤ç§å®ç°<br>
<ul class="org-ul">
<li><a id="orgb21e37a"></a>LSE<br>
<div class="outline-text-5" id="text-orgb21e37a">
<p>
ä½¿ç”¨ARMv8.1ä¸­æ–°å¢åŠ çš„åŸå­æ“ä½œæŒ‡ä»¤<br>
</p>
<div class="org-src-container">
<pre class="src src-C"><code><span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">ATOMIC_OP</span>(<span style="color: #dcaeea;">op</span>, <span style="color: #dcaeea;">asm_op</span>)                                                                   \</code>
<code>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">inline</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">__lse_atomic_</span>##op(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>, <span style="color: #ECBE7B;">atomic_t</span> *<span style="color: #dcaeea;">v</span>)    \</code>
<code>    {                                                                                                                   \</code>
<code>        <span style="color: #51afef;">asm</span> <span style="color: #51afef;">volatile</span>(                                                                                   \</code>
<code>                     <span style="color: #98be65;">"  "</span> #asm_op <span style="color: #98be65;">"     %w[i], %[v]\n"</span>                          \</code>
<code>                     : [i] <span style="color: #98be65;">"+r"</span> (i), [v] <span style="color: #98be65;">"+Q"</span> (v-&gt;counter)              \</code>
<code>                     : <span style="color: #98be65;">"r"</span> (v));                                                                \</code>
<code>    }</code>
<code></code>
<code>    <span style="color: #c678dd;">ATOMIC_OP</span>(andnot, stclr)</code>
<code>    <span style="color: #c678dd;">ATOMIC_OP</span>(or, stset)</code>
<code>    <span style="color: #c678dd;">ATOMIC_OP</span>(xor, steor)</code>
<code>    <span style="color: #c678dd;">ATOMIC_OP</span>(add, stadd)</code>
<code></code>
<code>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">inline</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">__lse_atomic64_sub</span>(<span style="color: #ECBE7B;">s64</span> <span style="color: #dcaeea;">i</span>, <span style="color: #ECBE7B;">atomic64_t</span> *<span style="color: #dcaeea;">v</span>)</code>
<code>{</code>
<code>    <span style="color: #51afef;">asm</span> <span style="color: #51afef;">volatile</span>(</code>
<code>                 <span style="color: #98be65;">"      neg     %[i], %[i]\n"</span></code>
<code>                 <span style="color: #98be65;">"      stadd   %[i], %[v]"</span></code>
<code>                 : [i] <span style="color: #98be65;">"+&amp;r"</span> (i), [v] <span style="color: #98be65;">"+Q"</span> (v-&gt;counter)</code>
<code>                 : <span style="color: #98be65;">"r"</span> (v));</code>
<code>}</code>
<code></code>
</pre>
</div>
<p>
ä»ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿä½¿ç”¨äº†å•æ¡æŒ‡ä»¤staddå°±å®Œæˆäº†åŸå­åŠ æ“ä½œï¼Œè¿™äº›æŒ‡ä»¤æ˜¯ARMv8.1 æ·»åŠ çš„æŒ‡ä»¤ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„AARCH64éƒ½æ”¯æŒè¿™ç§æŒ‡ä»¤ã€‚<br>
</p>
</div>
</li>

<li><a id="orgda68e58"></a>LL_SC]] Load-link/store-condiitional<br>
<div class="outline-text-5" id="text-orgda68e58">
<div class="org-src-container">
<pre class="src src-C"><code><span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">ATOMIC_OP</span>(<span style="color: #dcaeea;">op</span>, <span style="color: #dcaeea;">asm_op</span>, <span style="color: #dcaeea;">constraint</span>)                                                               \</code>
<code>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">inline</span> <span style="color: #ECBE7B;">void</span>                                                                                                  \</code>
<code>    <span style="color: #c678dd;">__ll_sc_atomic_</span>##op(<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>, <span style="color: #ECBE7B;">atomic_t</span> *<span style="color: #dcaeea;">v</span>)                                                             \</code>
<code>    {                                                                                                                                   \</code>
<code>        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">tmp</span>;                                                                                              \</code>
<code>        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">result</span>;                                                                                                             \</code>
<code>                                                                        \</code>
<code>        <span style="color: #51afef;">asm</span> <span style="color: #51afef;">volatile</span>(<span style="color: #98be65;">"// atomic_"</span> #op <span style="color: #98be65;">"\n"</span>                                                              \</code>
<code>                     __LL_SC_FALLBACK(                                                                  \</code>
<code>                                      <span style="color: #98be65;">" prfm    pstl1strm, %2\n"</span>                \</code>
<code>                                      <span style="color: #98be65;">"1:       ldxr    %w0, %2\n"</span>                      \</code>
<code>                                      <span style="color: #98be65;">" "</span> #asm_op <span style="color: #98be65;">"     %w0, %w0, %w3\n"</span>        \</code>
<code>                                      <span style="color: #98be65;">" stxr    %w1, %w0, %2\n"</span>                 \</code>
<code>                                      <span style="color: #98be65;">" cbnz    %w1, 1b\n"</span>)                             \</code>
<code>                     : <span style="color: #98be65;">"=&amp;r"</span> (result), <span style="color: #98be65;">"=&amp;r"</span> (tmp), <span style="color: #98be65;">"+Q"</span> (v-&gt;counter)   \</code>
<code>                     : __stringify(constraint) <span style="color: #98be65;">"r"</span> (i));                                \</code>
<code>    }</code>
<code></code>
<code><span style="color: #51afef; font-weight: bold;">    #define</span> <span style="color: #c678dd;">ATOMIC_OPS</span>(...)                                                     \</code>
<code>ATOMIC_OP(__VA_ARGS__)                                          \</code>
<code>    ATOMIC_OP_RETURN(        , <span style="color: #ECBE7B;">dmb</span> <span style="color: #dcaeea;">ish</span>,  , l, <span style="color: #98be65;">"memory"</span>, __VA_ARGS__)\</code>
<code>    ATOMIC_OP_RETURN(_relaxed,        ,  ,  ,         , __VA_ARGS__)\</code>
<code>    ATOMIC_OP_RETURN(_acquire,        , a,  , <span style="color: #98be65;">"memory"</span>, __VA_ARGS__)\</code>
<code>    ATOMIC_OP_RETURN(_release,        ,  , l, <span style="color: #98be65;">"memory"</span>, __VA_ARGS__)\</code>
<code>    ATOMIC_FETCH_OP (        , <span style="color: #ECBE7B;">dmb</span> <span style="color: #dcaeea;">ish</span>,  , l, <span style="color: #98be65;">"memory"</span>, __VA_ARGS__)\</code>
<code>    ATOMIC_FETCH_OP (_relaxed,        ,  ,  ,         , __VA_ARGS__)\</code>
<code>    ATOMIC_FETCH_OP (_acquire,        , a,  , <span style="color: #98be65;">"memory"</span>, __VA_ARGS__)\</code>
<code>    ATOMIC_FETCH_OP (_release,        ,  , l, <span style="color: #98be65;">"memory"</span>, __VA_ARGS__)</code>
<code></code>
<code><span style="color: #c678dd;">ATOMIC_OPS</span>(add, add, I)</code>
<code>    <span style="color: #c678dd;">ATOMIC_OPS</span>(sub, sub, J)</code>
<code></code>
</pre>
</div>
<p>
ä»è¿™é‡Œçš„å®ç°å¯ä¸€çœ‹åˆ°ï¼Œç³»ç»ŸåŒè¿‡ldxrå’ŒstxræŒ‡ä»¤å¯¹é…å’Œç®—æ•°è¿ç®—æŒ‡ä»¤ä¸€åŒå®ŒæˆåŸå­æ“ä½œã€‚<br>
</p>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-orgacbbfea" class="outline-3">
<h3 id="orgacbbfea">ARM64å¹³å°åŸå­æ“ä½œæŒ‡ä»¤</h3>
<div class="outline-text-3" id="text-orgacbbfea">
<p>
A64: ldx, ldax,stx,stlx<br>
A32/T32: ldrex, strex, ldaex, stlex<br>
</p>
<ul class="org-ul">
<li>ä»ä¸Šé¢Linuxçš„å®ç°ä¸­å°±å¯ä»¥å¾—çŸ¥ï¼Œåœ¨ARMv8ä¸­æœ‰å¯¹äºåŸå­æ“ä½œæœ‰ä¸¤ç§ä¸åŒå¾—å®ç°ï¼Œä¸€ç§æ˜¯LLSCå½¢å¼çš„åŸå­æ“ä½œï¼Œå¦ä¸€ç§æ˜¯LSE<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org4ec3ecb" class="outline-2">
<h2 id="org4ec3ecb">ARMV8aä¸­çš„è®¾ç½®</h2>
<div class="outline-text-2" id="text-org4ec3ecb">
</div>
<div id="outline-container-org43eb0e5" class="outline-3">
<h3 id="org43eb0e5">ARMv8aæ‰‹å†Œ</h3>
<div class="outline-text-3" id="text-org43eb0e5">
<p>
<a href="assets/screenshot_20191004_112725.png">ARMV8aä¸­å¯¹äºåŸå­æ“ä½œçš„æè¿°</a><br>
ä»¥ä¸Šåœ°æ–¹ä»…ä»…æè¿°äº†åŸå­æ“ä½œæŒ‡ä»¤ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå¹¶æ— æ³•æ‰¾åˆ°æˆ‘ä»¬çš„ç­”æ¡ˆï¼Œä¸‹é¢å»çœ‹çœ‹CPUæ‰‹å†Œå§ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org23693f0" class="outline-3">
<h3 id="org23693f0">Crotex A55æ‰‹å†Œ</h3>
<div class="outline-text-3" id="text-org23693f0">
<p>
<a href="assets/screenshot_20191004_120904.png">Crotex-A55-Atomic-Operation</a><br>
</p>
<ul class="org-ul">
<li>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°,åœ¨ARMv8ä¸­, å¯¹äºcacheable memory, åŸå­æ“ä½œéƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„, å› ä¸ºç³»ç»Ÿå¯ä»¥é€šè¿‡cacheæ¥å®ŒæˆåŸå­æ“ä½œ.<br></li>

<li><p>
å¯¹äºdevicesæˆ–è€…non-cacheableå†…å­˜, åŸå­æ“ä½œä¾èµ–äºäº’è”ç½‘ç»œçš„æ”¯æŒ. åœ¨armä¸Šå°±æ˜¯å„ç§AMBAæ€»çº¿,å¦‚æœäº’è”ç½‘ç»œä¸æ”¯æŒçš„è¯,å°±ä¼šå¼•å‘åŒæ­¥æˆ–è€…å¼‚æ­¥çš„å¼‚å¸¸.<br>
</p>

<p>
ä»ä»¥ä¸Šä¿¡æ¯å¯çŸ¥ï¼Œå¯¹äºéƒ¨åˆ†non-cacheableå†…å­˜ï¼Œåœ¨ARMå¹³å°ä¸Šï¼Œä¸æ”¯æŒåŸå­æ“ä½œçš„åŸå› æ˜¯å› ä¸ºç¡¬ä»¶çš„äº’è¿ç½‘ç»œä¸æ”¯æŒåŸå­æ“ä½œã€‚<br>
</p></li>
</ul>
</div>
<ul class="org-ul">
<li><a id="orgad1bb07"></a><span class="todo TODO">TODO</span> ä¸ºä»€ä¹ˆstore atomicsä¼šå¼•å‘å¼‚æ­¥çš„å¼‚å¸¸? è€Œä¸æ˜¯åŒæ­¥å¼‚å¸¸?<br></li>
</ul>
</div>

<div id="outline-container-orgc36d129" class="outline-3">
<h3 id="orgc36d129">CPUECTLR.ATOM</h3>
<div class="outline-text-3" id="text-orgc36d129">

<div id="orgd025ff2" class="figure">
<p><img src="assets/CPUECTLR-ATOM.png" alt="CPUECTLR-ATOM.png"><br>
</p>
</div>

<p>
é€šè¿‡CPUçš„è¿™ä¸ªå¯„å­˜å™¨å¯ä»¥æ§åˆ¶atomicè®¿é—®çš„æ—¶å€™å…·ä½“æ˜¯ä½¿ç”¨near/farï¼Œé»˜è®¤çš„é…ç½®ä¸­ï¼Œæ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œç¡¬ä»¶ä¸€èˆ¬ä¼šè‡ªåŠ¨æ ¹æ®cache hitçš„æƒ…å†µè‡ªåŠ¨åˆ‡æ¢ï¼Œè¿™ä¹‹ä¸­å¹¶ä¸éœ€è¦è½¯ä»¶çš„å‚ä¸ã€‚<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org0dcb094" class="outline-2">
<h2 id="org0dcb094">æ€»çº¿çš„è®¾ç½®</h2>
<div class="outline-text-2" id="text-org0dcb094">
<p>
å…³äºAMBAæ€»çº¿:<br>
å‚è€ƒ `ä»£ç æ”¹å˜ä¸–ç•Œctw` çš„æ–‡ç« ï¼Œå¯ä»¥å¯¹AMBAæ€»çº¿æœ‰ä¸ªå¤§æ¦‚çš„äº†è§£<br>
<a href="https://blog.csdn.net/weixin_42135087/article/details/111557929">https://blog.csdn.net/weixin_42135087/article/details/111557929</a><br>
åœ¨æ€»çº¿ä¸Šï¼Œä¸ºäº†exclude accessï¼Œç¡¬ä»¶ä¸Šæœ‰ä¸€å¥—å…·ä½“çš„åè®®æ¥æ”¯æŒï¼Œå¹¶ä¸”æœ‰ç›¸åº”ä¿¡å·ã€‚<br>
<a href="https://developer.arm.com/documentation/102202/0200/Atomic-accesses">AMBA AXI: Atomic transaction support</a><br>
<img src="assets/2021-11-03_20-51.png" alt="2021-11-03_20-51.png"><br>
ä»ä¸Šé¢armå®˜æ–¹çš„ç¤ºæ„å›¾ä¸­ï¼ŒAMBAä¸­ exclusive access monitor ä¼šå­˜å‚¨ä¼ è¾“çš„idå’Œåœ°å€ï¼Œç”±æ­¤æ¥ç›‘æ§åŸå­ä¼ è¾“ã€‚<br>
</p>
</div>
</div>

<div id="outline-container-orgedc72ed" class="outline-2">
<h2 id="orgedc72ed">å¯¹äºå†…æ ¸æ³¨é‡Šä¸­æåˆ°çš„omapå¹³å°ï¼Œç¡¬ä»¶ä¸Šä½¿ç”¨äº†å“ªç§äº’è¿ç½‘ç»œï¼Œæœ€ç»ˆå¯¼è‡´äº†ç³»ç»Ÿæ— æ³•åœ¨non-cachedå†…å­˜ä¸­ä½¿ç”¨åŸå­æ“ä½œï¼Ÿ</h2>
<div class="outline-text-2" id="text-orgedc72ed">
<p>
ç”±äºæ²¡æœ‰å…·ä½“çš„OMAPå¹³å°èµ„æ–™ï¼Œç”±ä¸Šè¿°çš„ä¿¡æ¯å¯ä»¥å¾—çŸ¥ï¼Œè¿™ä¸ªæ˜¯ç”±äºSOCå†…éƒ¨çš„æ€»çº¿ï¼Œæˆ–è€…æœ€åç«¯å†…å­˜çš„ç¡¬ä»¶å®ç°è€Œé€ æˆçš„ã€‚ä¸å…‰æ˜¯OMAPï¼Œå¾ˆå¤šARMå¹³å°çš„SOCéƒ½æœ‰ç›¸åŒçš„é—®é¢˜. ä½†æ˜¯ä¸€èˆ¬cacheéƒ½æ˜¯æ‰“å¼€çš„çŠ¶æ€ï¼Œæ‰€ä»¥è½¯ä»¶ä¸€èˆ¬ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªé—®é¢˜ã€‚<br>
</p>
</div>
</div>

<div id="outline-container-org373001f" class="outline-2">
<h2 id="org373001f"><span class="done DONE">DONE</span> å¯¹äºä¸Šè¿°å¹³å°ï¼Œå¦‚æœè½¯ä»¶ä¸Šå»ä½¿ç”¨åŸå­æ“ä½œæŒ‡ä»¤è®¿é—®non-cachedå†…å­˜ï¼Œä¼šæœ‰ä»€ä¹ˆåæœï¼Ÿ</h2>
<div class="outline-text-2" id="text-org373001f">
<p>
å‡ºç°é—®é¢˜ä¹‹åcpuä¼šè¿›å…¥åŒæ­¥å¼‚å¸¸<br>
Data abort with DFSC:<br>
0b110101 implementation defined fault (Unsupported Exclusive or Atomic access).<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code><span style="color: #dcaeea;">esr_el3</span>        = 0x0000000096000035</code>
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<script src="https://utteranc.es/client.js"
    repo="schspa/schspa.github.io"
    issue-term="title"
    label="âœ¨ğŸ’¬âœ¨"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
<div class="me">
  <span><b>Contact me via :)</b><span>
  <div class="contact">
    <a id="email" href="mailto:schspa@gmail.com" target="_blank"><i class="fab fa-mailchimp animated heartBeat delay-2s slower"></i></a>
    <a id="github" href="//github.com/schspa" target="_blank"><i class="fab fa-github animated heartBeat delay-2s slower"></i></a>
  </div>
</div>

<div id="jinrishici-sentence" style="font-weight: 700;">è™šæ€€ä¹ƒè‹¥è°·ï¼Œæ°´æ·±åˆ™æµç¼“ã€‚</div>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
</div>
</body>
</html>

<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-04-23 Sun 14:19 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux Debug object</title>
<meta name="author" content="Schspa Shi" />
<meta name="description" content="Linux Debug object" />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="/images/rose-red.png" type="image/x-icon" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha256-sAcc18zvMnaJZrNT4v8J0T4HqzEUiUTlVFgDIywjQek=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/animate.min.css" />
<link rel="stylesheet" href="/css/all.min.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />
<link rel="stylesheet" type="text/css" href="/css/navbar.css" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" integrity="sha256-/hGxZHGQ57fXLp+NDusFZsZo/PG21Bp2+hXYV5a6w+g=" crossorigin="anonymous"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/darkreader.js"></script>
<script src="/user.config.js"></script>
<script src="/js/main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div class="mobile-container">
  <!-- Top Navigation Menu -->
  <div class="topnav">
    <div id="header">
      <a href="/" class="logo">Schspa's Blog</a>
      <a href="javascript:void(0);" class="icon" onclick="toggleheader()">
        <i class="fa fa-bars"></i>
      </a>
    </div>
    <div id="nav_headers">
      <a href="/sitemap.html" class="menu-item">Categories</a>
    </div>
  </div>
  <!-- End smartphone / tablet look -->
</div>

<header id="header" class="header">
  <div class="logo-wrapper">
    <a href="/" class="logo">Schspa's Blogs</a>
  </div>

  <nav class="site-navbar">
    <ul id="menu" class="menu">
      <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li>
      <li class="menu-item">
        <a class="menu-item-link" href="/sitemap.html">Categories</a>
      </li>
    </ul>
  </nav>
</header>
</div>
<div id="content" class="content">
<h1 class="title">Linux Debug object</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgbd844f5">åŠŸèƒ½ä»‹ç»</a>
<ul>
<li><a href="#orgf3f020b">çŠ¶æ€åˆ—è¡¨</a></li>
<li><a href="#org3fa8767">çŠ¶æ€æµè½¬å›¾</a></li>
<li><a href="#org93fab3a">API</a></li>
</ul>
</li>
<li><a href="#org1a6042b">å®ä¾‹</a>
<ul>
<li><a href="#org544a66c">debugobjectså¯¹äºstatic objectå¤„ç†çš„BUG</a></li>
<li><a href="#orgb0339de">åŸå› åˆ†æ</a></li>
<li><a href="#org61cfa49">ä¸ºä»€ä¹ˆæ²¡æœ‰å½“ä½œé™æ€å¯¹è±¡å¤„ç†ï¼Ÿ</a></li>
<li><a href="#org4aef1c9">raceåœ¨å“ªé‡Œï¼Ÿ</a></li>
<li><a href="#org2d65865">ä¿®å¤</a>
<ul>
<li><a href="#orgbdb7f2a">V1</a></li>
<li><a href="#orgc5b7b8e">maintainer version</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgbd844f5" class="outline-2">
<h2 id="orgbd844f5">åŠŸèƒ½ä»‹ç»</h2>
<div class="outline-text-2" id="text-orgbd844f5">
<p>
Debug Object æ˜¯å†…æ ¸ä¸­ä¸ºäº†ç›‘æ§å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œå¼•å…¥çš„æ£€æµ‹æœºåˆ¶ï¼Œé€šè¿‡è¯¥æœºåˆ¶ï¼Œç³»ç»Ÿä¼š<br>
åœ¨å¯¹è±¡å‘ç”Ÿä¸æ­£å¸¸çŠ¶æ€åˆ‡æ¢æ—¶æŠ¥å‡ºæ¥é”™è¯¯ã€‚<br>
</p>
</div>

<div id="outline-container-orgf3f020b" class="outline-3">
<h3 id="orgf3f020b">çŠ¶æ€åˆ—è¡¨</h3>
<div class="outline-text-3" id="text-orgf3f020b">
<dl class="org-dl">
<dt>none</dt><dd>æœªåˆå§‹åŒ–<br></dd>
<dt>initialized</dt><dd>å·²åˆå§‹åŒ–<br></dd>
<dt>inactive</dt><dd>åˆå§‹åŒ–ï¼Œä½†æœªæ¿€æ´»<br></dd>
<dt>active</dt><dd>åˆå§‹åŒ–ï¼Œå·²æ¿€æ´»<br></dd>
<dt>destroyed</dt><dd>å·²é”€æ¯<br></dd>
<dt>not available</dt><dd>æœªæ‰¾åˆ°å¯¹è±¡<br></dd>
</dl>
</div>
</div>

<div id="outline-container-org3fa8767" class="outline-3">
<h3 id="org3fa8767">çŠ¶æ€æµè½¬å›¾</h3>
<div class="outline-text-3" id="text-org3fa8767">
<p>
ä¸‹å›¾æ˜¯debug objectçš„çŠ¶æ€æµè½¬å›¾ï¼Œä¸‹è¿°æµç¨‹ä¹‹å¤–çš„çŠ¶æ€æ˜¯ä¸å¤‡è¢«å…è®¸çš„<br>
</p>

<div id="orgc1b25d6" class="figure">
<p><img src="assets/debug-object-stats.png" alt="debug-object-stats.png"><br>
</p>
</div>
</div>
</div>

<div id="outline-container-org93fab3a" class="outline-3">
<h3 id="org93fab3a">API</h3>
<div class="outline-text-3" id="text-org93fab3a">
<p>
å¤´æ–‡ä»¶å¦‚ä¸‹ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-preprocessor">#include</span> <span class="org-string">&lt;linux/debugobjects.h&gt;</span></code>
</pre>
</div>

<p>
debugobjectsçš„ API æ¯”è¾ƒç®€å•ï¼Œåœ¨æ­¤ä¸åšè§£é‡Šã€‚<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org1a6042b" class="outline-2">
<h2 id="org1a6042b">å®ä¾‹</h2>
<div class="outline-text-2" id="text-org1a6042b">
</div>
<div id="outline-container-org544a66c" class="outline-3">
<h3 id="org544a66c">debugobjectså¯¹äºstatic objectå¤„ç†çš„BUG</h3>
<div class="outline-text-3" id="text-org544a66c">
<p>
syzbot link: <a href="https://syzkaller.appspot.com/bug?id=22c8a5938eab640d1c6bcc0e3dc7be519d878462">WARNING in __mod_timer</a><br>
</p>

<p>
Log å¦‚ä¸‹ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>------------[ cut here ]------------</code>
<code>ODEBUG: assert_init not available (active state 0) object: ffffffff8d4fcbc0 object type: timer_list hint: key_gc_timer_func+0x0/0x80 security/keys/gc.c:117</code>
<code>WARNING: CPU: 1 PID: 10646 at lib/debugobjects.c:512 debug_print_object lib/debugobjects.c:509 [inline]</code>
<code>WARNING: CPU: 1 PID: 10646 at lib/debugobjects.c:512 debug_object_assert_init+0x1f2/0x240 lib/debugobjects.c:899</code>
<code>Modules linked<span class="org-keyword"> in</span>:</code>
<code>CPU: 1 PID: 10646 Comm: syz-executor.3 Not tainted 6.2.0-syzkaller-06695-gd8ca6dbb8de7 <span class="org-comment-delimiter">#</span><span class="org-comment">0</span></code>
<code>Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/21/2023</code>
<code>RIP: 0010:debug_print_object lib/debugobjects.c:509 [inline]</code>
<code>RIP: 0010:debug_object_assert_init+0x1f2/0x240 lib/debugobjects.c:899</code>
<code>Code: a0 fd 4c 8b 4d 00 48 c7 c7 20 68 38 8b 48 c7 c6 00 65 38 8b 48 c7 c2 e0 69 38 8b 31 c9 4d 89 e8 53 e8 42 6f 10 fd 48 83 c4 08 &lt;0f&gt; 0b ff 05 42 e1 10 0a 48 83 c5 38 48 89 e8 48 c1 e8 03 42 80 3c</code>
<code>RSP: 0018:ffffc9000b1276f8 EFLAGS: 00010282</code>
<code>RAX: caefb79dfa053800 RBX: ffffffff83f63700 RCX: 0000000000040000</code>
<code>RDX: ffffc90014421000 RSI: 0000000000018ba9 RDI: 0000000000018baa</code>
<code>RBP: ffffffff8aec5400 R08: ffffffff81536d42 R09: fffff52001624e55</code>
<code>R10: 0000000000000000 R11: dffffc0000000001 R12: dffffc0000000000</code>
<code>R13: ffffffff8d4fcbc0 R14: 0000000000000004 R15: ffffffff91d3e4e8</code>
<code>FS:  00007f122cc29700(0000) GS:ffff8880b9900000(0000) knlGS:0000000000000000</code>
<code>CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033</code>
<code>CR2: 000055555632f708 CR3: 00000000690df000 CR4: 00000000003526e0</code>
<code>DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000</code>
<code>DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400</code>
<code>Call Trace:</code>
<code> &lt;TASK&gt;</code>
<code> debug_timer_assert_init kernel/time/timer.c:792 [inline]</code>
<code> debug_assert_init kernel/time/timer.c:837 [inline]</code>
<code> __mod_timer+0x10d/0xf40 kernel/time/timer.c:1020</code>
<code> key_reject_and_link+0x3f5/0x6e0 security/keys/key.c:610</code>
<code> key_negate_and_link include/linux/key-type.h:187 [inline]</code>
<code> complete_request_key security/keys/request_key.c:64 [inline]</code>
<code> call_sbin_request_key+0xa7b/0xcd0 security/keys/request_key.c:213</code>
<code> construct_key security/keys/request_key.c:244 [inline]</code>
<code> construct_key_and_link security/keys/request_key.c:503 [inline]</code>
<code> request_key_and_link+0x11e3/0x18e0 security/keys/request_key.c:637</code>
<code> __do_sys_request_key security/keys/keyctl.c:222 [inline]</code>
<code> __se_sys_request_key+0x271/0x3b0 security/keys/keyctl.c:167</code>
<code> do_syscall_x64 arch/x86/entry/common.c:50 [inline]</code>
<code> do_syscall_64+0x41/0xc0 arch/x86/entry/common.c:80</code>
<code> entry_SYSCALL_64_after_hwframe+0x63/0xcd</code>
</pre>
</div>

<p>
ODEBUG: assert_init not available (active state 0) object: ffffffff8d4fcbc0 object type: timer_list hint:<br>
</p>

<p>
ç”±ä¸Šé¢é¢logå¯çŸ¥ï¼ŒLinuxçš„å¯†é’¥ç®¡ç†æ¨¡å—åœ¨è°ƒç”¨ <code>mod_timer</code> æ—¶å‘ç°ï¼Œè¿™ä¸ªtimerå¯¹è±¡æœªåˆå§‹åŒ–ï¼Œæ‰€ä»¥è§¦å‘äº†assertçš„æ£€æŸ¥ã€‚<br>
</p>
</div>
</div>

<div id="outline-container-orgb0339de" class="outline-3">
<h3 id="orgb0339de">åŸå› åˆ†æ</h3>
<div class="outline-text-3" id="text-orgb0339de">
<p>
è°ƒç”¨è·¯å¾„ï¼š<br>
key_schedule_gc(key-&gt;expiry + key_gc_delay);<br>
  mod_timer(&amp;key_gc_timer, expires);<br>
</p>

<p>
è¿™é‡Œçš„ <code>key_gc_timer</code> æ˜¯ä¸ªå…¨å±€é™æ€å®šä¹‰çš„timerå¯¹è±¡, å¯¹äºé™æ€å®šä¹‰çš„timerå¯¹è±¡, æ˜¯ä¸<br>
éœ€è¦æ˜¾å¼è°ƒç”¨ <code>timer_setup</code> ç­‰åˆå§‹åŒ–å‡½æ•°æ¥è¿›è¡Œåˆå§‹åŒ–çš„ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-comment-delimiter">/*</span></code>
<code><span class="org-comment"> * Reaper for links from keyrings to dead keys.</span></code>
<code><span class="org-comment-delimiter"> */</span></code>
<code><span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">key_gc_timer_func</span>(<span class="org-keyword">struct</span> <span class="org-type">timer_list</span> *);</code>
<code><span class="org-keyword">static</span> DEFINE_TIMER(key_gc_timer, key_gc_timer_func);</code>
</pre>
</div>

<p>
å¯¹äº <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/lib/debugobjects.c?id=d8ca6dbb8de7923fcfb18e0b0b123f37c3225519#n870"><code>debug_object_assert_init</code></a> å‡½æ•°ï¼Œ<br>
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-doc">/**</span></code>
<code><span class="org-doc"> * debug_object_assert_init - debug checks when object should be init-ed</span></code>
<code><span class="org-doc"> * </span><span class="org-doc"><span class="org-doc-markup"><span class="org-doc-markup">@addr</span></span></span><span class="org-doc">:       address of the object</span></code>
<code><span class="org-doc"> * </span><span class="org-doc"><span class="org-doc-markup"><span class="org-doc-markup">@descr</span></span></span><span class="org-doc">:      pointer to an object specific debug description structure</span></code>
<code><span class="org-doc"> */</span></code>
<code><span class="org-type">void</span> <span class="org-function-name">debug_object_assert_init</span>(<span class="org-type">void</span> *<span class="org-variable-name">addr</span>, <span class="org-keyword">const</span> <span class="org-keyword">struct</span> <span class="org-type">debug_obj_descr</span> *<span class="org-variable-name">descr</span>)</code>
<code>{</code>
<code>    <span class="org-keyword">struct</span> <span class="org-type">debug_bucket</span> *<span class="org-variable-name">db</span>;</code>
<code>    <span class="org-keyword">struct</span> <span class="org-type">debug_obj</span> *<span class="org-variable-name">obj</span>;</code>
<code>    <span class="org-type">unsigned</span> <span class="org-type">long</span> <span class="org-variable-name">flags</span>;</code>
<code></code>
<code>    <span class="org-keyword">if</span> (<span class="org-negation-char">!</span>debug_objects_enabled)</code>
<code>        <span class="org-keyword">return</span>;</code>
<code></code>
<code>    db = get_bucket((<span class="org-type">unsigned</span> <span class="org-type">long</span>) addr);</code>
<code></code>
<code>    raw_spin_lock_irqsave(&amp;db-&gt;lock, flags);</code>
<code></code>
<code>    obj = lookup_object(addr, db);</code>
<code>    <span class="org-keyword">if</span> (<span class="org-negation-char">!</span>obj) {</code>
<code>        <span class="org-keyword">struct</span> <span class="org-type">debug_obj</span> <span class="org-variable-name">o</span> = { .object = addr,</code>
<code>                       .state = ODEBUG_STATE_NOTAVAILABLE,</code>
<code>                       .descr = descr };</code>
<code></code>
<code>        raw_spin_unlock_irqrestore(&amp;db-&gt;lock, flags);</code>
<code>        <span class="org-comment-delimiter">/*</span></code>
<code><span class="org-comment">         * Maybe the object is static, and we let the type specific</span></code>
<code><span class="org-comment">         * code confirm. Track this static object if true, else invoke</span></code>
<code><span class="org-comment">         * fixup.</span></code>
<code><span class="org-comment-delimiter">         */</span></code>
<code>        <span class="org-keyword">if</span> (descr-&gt;is_static_object &amp;&amp; descr-&gt;is_static_object(addr)) {</code>
<code>            <span class="org-comment-delimiter">/* </span><span class="org-comment">Track this static object</span><span class="org-comment-delimiter"> */</span></code>
<code>            debug_object_init(addr, descr);</code>
<code>        } <span class="org-keyword">else</span> {</code>
<code>            debug_print_object(&amp;o, <span class="org-string">"assert_init"</span>);</code>
<code>            debug_object_fixup(descr-&gt;fixup_assert_init, addr,</code>
<code>                       ODEBUG_STATE_NOTAVAILABLE);</code>
<code>        }</code>
<code>        <span class="org-keyword">return</span>;</code>
<code>    }</code>
<code></code>
<code>    raw_spin_unlock_irqrestore(&amp;db-&gt;lock, flags);</code>
<code>}</code>
<code><span class="org-function-name">EXPORT_SYMBOL_GPL</span>(debug_object_assert_init);</code>
</pre>
</div>

<p>
ä¸Šé¢å¯¹äºstaticçš„å¤„ç†æ˜¯æœ‰åˆ¤æ–­çš„ï¼Œå¯¹äºé™æ€æ•°æ®ï¼Œå…è®¸åœ¨assert_initæ—¶ï¼Œç›´æ¥å°†å¯¹åº”çš„debugobjectè¿›è¡Œåˆå§‹åŒ–ã€‚<br>
</p>

<p>
ä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä»£ç ç¥å¥‡çš„è·‘åˆ°äº†elseåˆ†æ”¯ï¼Œå¹¶æ²¡æœ‰å°†è¿™ä¸ªtimerå½“ä½œé™æ€å¯¹è±¡æ¥å¤„ç†ã€‚<br>
</p>
</div>
</div>

<div id="outline-container-org61cfa49" class="outline-3">
<h3 id="org61cfa49">ä¸ºä»€ä¹ˆæ²¡æœ‰å½“ä½œé™æ€å¯¹è±¡å¤„ç†ï¼Ÿ</h3>
<div class="outline-text-3" id="text-org61cfa49">
<p>
å…ˆçœ‹çœ‹åˆ¤æ–­é™æ€å¯¹è±¡çš„ä»£ç ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-preprocessor">#define</span> <span class="org-function-name">__TIMER_INITIALIZER</span>(<span class="org-variable-name">_function</span>, <span class="org-variable-name">_flags</span>) {        \</code>
<code>        .entry = { .next = TIMER_ENTRY_STATIC },        \</code>
<code>        .function = (_function),                        \</code>
<code>        .flags = (_flags),                              \</code>
<code>        __TIMER_LOCKDEP_MAP_INITIALIZER(                \</code>
<code>            __FILE__ <span class="org-string">":"</span> __stringify(__LINE__))         \</code>
<code>    }</code>
<code></code>
<code><span class="org-preprocessor">#define</span> <span class="org-function-name">DEFINE_TIMER</span>(<span class="org-variable-name">_name</span>, <span class="org-variable-name">_function</span>)          \</code>
<code>    <span class="org-keyword">struct</span> <span class="org-type">timer_list</span> <span class="org-variable-name">_name</span> =                   \</code>
<code>        __TIMER_INITIALIZER(_function, 0)</code>
<code></code>
<code><span class="org-keyword">static</span> <span class="org-type">bool</span> <span class="org-function-name">timer_is_static_object</span>(<span class="org-type">void</span> *<span class="org-variable-name">addr</span>)</code>
<code>{</code>
<code>    <span class="org-keyword">struct</span> <span class="org-type">timer_list</span> *<span class="org-variable-name">timer</span> = addr;</code>
<code></code>
<code>    <span class="org-keyword">return</span> (timer-&gt;entry.pprev == <span class="org-constant">NULL</span> &amp;&amp;</code>
<code>        timer-&gt;entry.next == TIMER_ENTRY_STATIC);</code>
<code>}</code>
</pre>
</div>

<p>
ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿæ˜¯é€šè¿‡ <code>timer-&gt;entry</code> çš„å€¼æ¥çŸ¥é“æ­¤å¯¹è±¡æ˜¯ä¸€ä¸ªé™æ€å¯¹è±¡çš„ã€‚<br>
è¿™æ ·å°±å¾ˆå®¹æ˜“è”æƒ³åˆ°ï¼Œå¦‚æœtimerè¢«åŠ å…¥ç³»ç»Ÿçš„timer listä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªtimerå¯¹è±¡çš„<br>
<code>timer-&gt;entry</code> çš„å€¼å°±å’Œåˆå§‹å€¼ä¸ä¸€æ ·äº†ï¼Œæ‰€ä»¥å¦‚æœtimerè¢«ä½¿ç”¨ä¹‹åï¼Œè¿™ä¸ªåˆ¤æ–­å°±ä¸æˆç«‹<br>
äº†ã€‚<br>
</p>

<p>
Whatï¼Ÿ æ˜¯ä¸æ˜¯å‘ç°äº†ä¸ªå¤§BUGï¼Œä¸ºä»€ä¹ˆsyzbotæ‰æŠ¥äº†è¿™ä¹ˆä¸€æ¬¡ï¼Ÿ<br>
</p>

<p>
ç»è¿‡åˆ†æï¼Œè¿™ä¸ªé—®é¢˜å…¶å®å¹¶ä¸ä¸¥é‡ï¼Œå®é™…ä¸Šï¼Œå¯¹äºé™æ€å¯¹è±¡ï¼Œåªæœ‰åœ¨è°ƒç”¨ debug_object_activate å’Œ debug_object_assert_init æ—¶æ‰æœ‰ç‰¹æ®Šå¤„ç†ã€‚å…¶ä»–åœ°æ–¹æ²¡æœ‰ç›¸å…³çš„å¤„ç†ã€‚<br>
</p>

<p>
å¯¹äº debug_object_activate, åªè¦ä¸æ˜¯é¦–æ¬¡è°ƒç”¨ï¼Œç³»ç»Ÿéƒ½å¯ä»¥æ‰¾åˆ°å·²ç»ç”³è¯·åˆ°çš„<br>
debugobjectå¯¹è±¡ï¼Œä»è€Œå¯ä»¥æ­£ç¡®çš„æ¥å¤„ç†è¿™ä¸ªå¯¹è±¡çš„çŠ¶æ€ã€‚<br>
</p>

<p>
å¯¹äº debug_object_assert_initï¼Œ ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œåªæœ‰åœ¨é¦–æ¬¡è°ƒæ—¶ï¼Œä¾èµ–äºå¯¹è±¡çš„çŠ¶æ€ã€‚æ‰€<br>
ä»¥æ¥è¨€ï¼Œåªæœ‰åœ¨å¯¹è±¡ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ä¼šæœ‰æ¦‚ç‡å‡ºç°é—®é¢˜ï¼Œè€Œé™æ€å¯¹è±¡ï¼Œä¸€èˆ¬ä¸å­˜åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨<br>
å°±å‡ºç°å¹¶å‘çš„åœºæ™¯ï¼Œè¿™ä¸ªå‡ºç°é—®é¢˜çš„æƒ…æ™¯å°±æ¯”è¾ƒå°‘è§ã€‚<br>
</p>
</div>
</div>

<div id="outline-container-org4aef1c9" class="outline-3">
<h3 id="org4aef1c9">raceåœ¨å“ªé‡Œï¼Ÿ</h3>
<div class="outline-text-3" id="text-org4aef1c9">
<p>
æˆ‘çš„patch commentså·²ç»å¯¹ç°è±¡çš„ç°åœºåšäº†åˆ†æã€‚<br>
</p>

<p>
Link: <a href="https://lore.kernel.org/all/20230303161906.831686-1-schspa@gmail.com/">https://lore.kernel.org/all/20230303161906.831686-1-schspa@gmail.com/</a><br>
</p>

<div class="org-src-container">
<pre class="src src-text"><code>T0                                                   T1</code>
<code>=========================================================================</code>
<code>mod_timer();</code>
<code>  debug_object_assert_init</code>
<code>    db = get_bucket((unsigned long) addr);</code>
<code>    raw_spin_lock_irqsave(&amp;db-&gt;lock, flags);</code>
<code>    obj = lookup_object(addr, db);</code>
<code>    if (!obj) {</code>
<code>        raw_spin_unlock_irqrestore(&amp;db-&gt;lock, flags);</code>
<code>        &lt;&lt; Context switch &gt;&gt;</code>
<code>                                             mod_timer();</code>
<code>                                               debug_object_assert_init</code>
<code>                                               ...</code>
<code>                                               enqueue_timer();</code>
<code>        /*</code>
<code>         * The initial state changed a static timer object, and</code>
<code>         * is_static_object will return false</code>
<code>         */</code>
<code></code>
<code>        if (descr-&gt;is_static_object &amp;&amp;</code>
<code>            descr-&gt;is_static_object(addr)) {</code>
<code>                debug_object_init();</code>
<code>            } else {</code>
<code>               &lt;&lt; Hit here for a static object &gt;&gt;</code>
<code>               debug_print_object(&amp;o, "assert_init");</code>
<code>               debug_object_fixup(descr-&gt;fixup_assert_init, addr,</code>
<code>                       ODEBUG_STATE_NOTAVAILABLE);</code>
<code>            }</code>
<code>    }</code>
</pre>
</div>

<p>
ä¸Šé¢çš„åœºæ™¯æè¿°äº†é—®é¢˜å‘ç°çš„åœºæ™¯ï¼Œä»åœ°å€æ¥è·å–debugobjectå¯¹è±¡è¿™ä¸ªåœ°æ–¹ï¼Œå®é™…ä¸Šéƒ½æœ‰<br>
<code>&amp;db-&gt;lock</code> æ¥ä¿æŠ¤ï¼Œè€Œ <code>is_static_object</code> çš„çŠ¶æ€åˆ¤æ–­å®é™…ä¸Šä¾èµ–äºå¯¹è±¡çš„åˆå§‹çŠ¶æ€ï¼Œ<br>
æ‰€ä»¥ï¼Œäº‹å®ä¸Š <code>is_static_object</code> ä¹Ÿåº”è¯¥åœ¨ç³»ç»Ÿç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™æ¥åˆ¤æ–­ï¼Œ è€Œ<br>
<code>&amp;db-&gt;lock</code> åˆšå¥½å¯ä»¥ç”¨æ¥ä¿è¯ç¬¬ä¸€æ¬¡ç”³è¯·å¯¹è±¡çš„æ—¶å€™å†è°ƒç”¨ <code>is_static_object</code> çš„æ¥å£ã€‚<br>
</p>
</div>
</div>

<div id="outline-container-org2d65865" class="outline-3">
<h3 id="org2d65865">ä¿®å¤</h3>
<div class="outline-text-3" id="text-org2d65865">
</div>
<div id="outline-container-orgbdb7f2a" class="outline-4">
<h4 id="orgbdb7f2a">V1</h4>
<div class="outline-text-4" id="text-orgbdb7f2a">
<ul class="org-ul">
<li>è§£å†³æ€è·¯<br>

<ol class="org-ol">
<li>æ·»åŠ é¢å¤–çš„çŠ¶æ€ï¼Œå¹¶ä¿è¯åœ¨ <code>&amp;db-&gt;lock</code> é”èŒƒå›´å†…ï¼Œåœ¨å¯¹è±¡é¦–æ¬¡åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨<br>
<code>is_static_object</code> æ¥å£ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨debugobjectå¯¹è±¡ä¸­å»ã€‚<br></li>
<li>åœ¨åˆ¤æ–­é™æ€å¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœå·²ç»æ‰¾åˆ°å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›ä¹‹é—´ä¿å­˜çš„é™æ€å¯¹è±¡çŠ¶æ€ä½ï¼Œ<br>
è€Œä¸éœ€è¦è°ƒç”¨ <code>is_static_object</code> ã€‚<br></li>
</ol></li>

<li>å­˜åœ¨çš„é—®é¢˜<br>

<ol class="org-ol">
<li>debug_objects_selftest ä¸­å°†ä¸€ä¸ªå…¨å±€å˜é‡ä»ä¸æ˜¯staticçš„ç±»å‹ï¼Œå˜ä¸ºäº†staticç±»å‹ï¼Œ<br>
è¿™æ ·ï¼Œç”±äºdebugobjectå¯¹è±¡å·²ç»æ‰¾åˆ°ï¼Œæ­¤æ—¶å°†ä¸ä¼šè°ƒç”¨ <code>is_static_object</code> æ¥å£ï¼Œ<br>
ä»è€Œï¼Œäº‹å®ä¸Šï¼Œæœªèƒ½å°†æœŸè½¬å˜ä¸ºstaticå¯¹è±¡ï¼Œå› æ­¤éœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ç›®å‰çš„æµ‹è¯•caseã€‚<br></li>
</ol></li>
</ul>

<p>
Link: <a href="https://lore.kernel.org/all/20230303161906.831686-1-schspa@gmail.com/">https://lore.kernel.org/all/20230303161906.831686-1-schspa@gmail.com/</a><br>
</p>
</div>
</div>

<div id="outline-container-orgc5b7b8e" class="outline-4">
<h4 id="orgc5b7b8e">maintainer version</h4>
<div class="outline-text-4" id="text-orgc5b7b8e">
<ul class="org-ul">
<li>è§£å†³æ€è·¯<br>

<ol class="org-ol">
<li>ç”±äºå‡ºç°é—®é¢˜æ˜¯ç”±äºæŸ¥æ‰¾å¯¹è±¡å’Œåˆå§‹åŒ–å¯¹è±¡æ˜¯åœ¨ä¸¤æ¬¡å•ç‹¬çš„ä¸´ç•ŒåŒºï¼Œå› æ­¤é€ æˆäº†çŠ¶æ€<br>
ä¸ä¸€è‡´ï¼Œæ‰€ä»¥å°†è¿™ä¸¤ä¸ªè¿‡ç¨‹åˆå¹¶åœ¨ä¸€ä¸ªä¸´ç•Œå»ä¸­å®Œæˆï¼Œä»è€Œå®ŒæˆBUGä¿®å¤ã€‚<br></li>
</ol></li>
</ul>

<p>
Link: <a href="https://lore.kernel.org/all/87zg7dzgao.ffs@tglx/">https://lore.kernel.org/all/87zg7dzgao.ffs@tglx/</a><br>
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<script src="https://utteranc.es/client.js"
    repo="schspa/schspa.github.io"
    issue-term="title"
    label="âœ¨ğŸ’¬âœ¨"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
<div class="me">
  <span><b>Contact me via :)</b><span>
  <div class="contact">
    <a id="email" href="mailto:schspa@gmail.com" target="_blank"><i class="fab fa-mailchimp animated heartBeat delay-2s slower"></i></a>
    <a id="github" href="//github.com/schspa" target="_blank"><i class="fab fa-github animated heartBeat delay-2s slower"></i></a>
  </div>
</div>

<div id="jinrishici-sentence" style="font-weight: 700;">è™šæ€€ä¹ƒè‹¥è°·ï¼Œæ°´æ·±åˆ™æµç¼“ã€‚</div>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
</div>
</body>
</html>